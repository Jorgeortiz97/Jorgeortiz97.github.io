---
layout: post
title: "pHash for FPGA"
subtitle: "Implementation of perceptual hashing algorithm in a FPGA system"
date: 2019-06-01 15:00:00 -0400
background: '/img/posts/02.png'
topic: FPGA
---

# Description

The main objective of this work is the implementation of a perceptual hashing algorithm. These functions or algorithms are used in finding cases of online copyright infringement. The aim of this project was to create a useful hashing algorithm for [reverse image search](https://en.wikipedia.org/wiki/Reverse_image_search). I have been followed the tutorial that appears on the [HackerFactor blog](http://hackerfactor.com/blog/index.php%3F/archives/432-Looks-Like-It.html).

In order to reduce the execution time, the fundamental operation of this algorithm has been designed and synthesized in a FPGA system. This operation is the calculation of the Discrete Cosine Transform (DCT). DCTs are very important to numerous applications in engineering. For example, lossy compression of audio (MP3) and images (JPG). 

## Design

Each value of the output vector 'out' is calculated using the following expression:

$$ Out_i = \sum_{j=0}^{N-1} In_j * cos [\frac{\pi}{N}*(j+\frac{1}{2})*i] $$

Besides that, it is necessary to multiply the $$Out_0$$ term by $$\frac{1}{\sqrt{2}}$$ and multiply the resulting vector by an overall scale factor of $$\sqrt{\frac{2}{N}}$$.


The code that appears below contains the implementation of the expression:

```c
const float ISQRT2	 = 1.0f / sqrtf(2.0f);
const float SCALE_FACTOR = sqrtf(2.0f / DIM);
const float PI_FACTOR	 = M_PI / DIM;

void dct_1d_sw(float in[DIM], float out[DIM]) {
	
	for (int i = 0; i < DIM; i++) {
		float acc = .0f;

		for (int j = 0; j < DIM; j++)
			acc += in[j] * cosf(i * (j + 0.5f) * PI_FACTOR);

		acc *= SCALE_FACTOR;

		if (i == 0) acc *= ISQRT2;
		out[i] = acc;
	}
}
```


## Hardware platform
The designs have been synthesized on a ZedBoard board, which incorporates the *System on a Chip* Zynq-7000. That SoC combines a Dual-core ARM Cortex™-A9 processor with a FPGA and 512 MB of DDR3 RAM. The ARM processor operates at a frequency of 667 MHz. The FPGA is composed of the following resources:

* 280 RAM blocks of 18 Kb (≈ 4.92 MB).
* 220 units DSP_48E.
* 106400 flip-flops.
* 53200 LUTs (* Look-Up Table *).

## In construction...